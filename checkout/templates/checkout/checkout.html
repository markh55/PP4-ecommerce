{% extends "core/base.html" %} {% load static %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'checkout/css/checkout.css' %}" />
{% endblock %} {% block extra_js %}
<script src="{% static 'checkout/js/checkout.js' %}"></script>
{% endblock %} {% block page_header %}
<div class="container header-container">
  <div class="row">
    <div class="col"></div>
  </div>
</div>
{% endblock %} {% block content %}
<div id="loading-overlay">
  <h1 class="text-light logo-font loading-spinner">
    <span class="icon">
      <i class="fas fa-3x fa-sync-alt fa-spin"></i>
    </span>
  </h1>
</div>

<div class="overlay"></div>
<div class="container my-6">
  <div class="row">
    <div class="col">
      <h2 class="section-title text-center mt-5 pt-5">
        <strong>CHECKOUT</strong>
      </h2>
    </div>
  </div>

  <div class="row">
    <!-- Order Summary Column - RIGHT SIDE -->
    <div class="col-12 col-lg-6 order-lg-last mb-5">
      <p class="text-muted">Order Summary ({{ services_summary|length }})</p>
      <div class="row">
        <div class="col-7 offset-2">
          <p class="mb-1 mt-0 small text-muted">Item</p>
        </div>
        <div class="col-3 text-end">
          <p class="mb-1 mt-0 small text-muted">Subtotal</p>
        </div>
      </div>
      {% for item in services_summary %}
      <div class="row">
        <div class="col-2 mb-1">
          {% if item.image %}
          <img class="w-100" src="{{ item.image.url }}" alt="{{ item.name }}" />
          {% else %}
          <img
            class="w-100"
            src="{% static 'images/default-package.jpg' %}"
            alt="{{ item.name }}"
          />
          {% endif %}
        </div>
        <div class="col-7">
          <p class="my-0"><strong>{{ item.name }}</strong></p>
          <p class="my-0 small text-muted">Qty: 1</p>
          <div class="mt-2">
            <a
              href="{% url 'bag:view_bag' %}"
              class="btn btn-sm btn-outline-secondary me-2 mb-3"
              >Edit</a
            >
          </div>
        </div>
        <div class="col-3 text-end">
          <p class="my-0 small text-muted">£{{ item.price }}</p>
        </div>
      </div>
      {% empty %}
      <p class="text-center text-muted">Your bag is empty</p>
      {% endfor %}
      <hr class="my-0" />
      <div class="row text-black text-end">
        <div class="col-7 offset-2">
          <p class="my-0">Order Total:</p>
          <p class="my-0">Grand Total:</p>
        </div>
        <div class="col-3">
          <p class="my-0">£{{ total|floatformat:2 }}</p>
          <p class="my-0"><strong>£{{ grand_total|floatformat:2 }}</strong></p>
        </div>
      </div>
    </div>

    <!-- Checkout Form Column - LEFT SIDE -->
    <div class="col-12 col-lg-6">
      <p class="text-muted">
        Please fill out the form below to complete your order
      </p>

      <div class="checkout-box">
        <form
          id="payment-form"
          method="POST"
          action="{% url 'checkout:checkout' %}"
        >
          {% csrf_token %}

          <!-- Details Section -->
          <fieldset class="mb-3">
            <legend class="fieldset-label small text-black px-2 w-auto">
              Details
            </legend>
            <div class="mb-3">
              <input
                type="text"
                class="form-control"
                id="first_name"
                name="first_name"
                placeholder="First Name *"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="text"
                class="form-control"
                id="surname"
                name="surname"
                placeholder="Surname *"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="text"
                class="form-control"
                id="business_name"
                name="business_name"
                placeholder="Business Name (Optional)"
              />
            </div>
          </fieldset>

          <!-- Contact Information Section -->
          <fieldset class="mb-3">
            <legend class="fieldset-label small text-black px-2 w-auto">
              Contact Information
            </legend>
            <div class="mb-3">
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                placeholder="Email Address *"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="tel"
                class="form-control"
                id="phone_number"
                name="phone_number"
                placeholder="Phone Number *"
                required
              />
            </div>
            <div class="mb-3">
              <select
                class="form-control"
                id="preferred_contact"
                name="preferred_contact"
              >
                <option value="">Preferred Contact Method</option>
                <option value="email">Email</option>
                <option value="phone">Phone</option>
                <option value="both">Both Email & Phone</option>
              </select>
            </div>
            <div class="mb-3">
              <select
                class="form-control"
                id="preferred_contact_time"
                name="preferred_contact_time"
              >
                <option value="">Preferred Contact Time</option>
                <option value="morning">Morning (9am - 12pm)</option>
                <option value="afternoon">Afternoon (12pm - 5pm)</option>
                <option value="evening">Evening (5pm - 8pm)</option>
                <option value="anytime">Anytime</option>
              </select>
            </div>
            <div class="mb-3">
              <textarea
                class="form-control"
                id="special_requirements"
                name="special_requirements"
                rows="3"
                placeholder="Additional Notes (Optional)"
              ></textarea>
            </div>
          </fieldset>

          <!-- Save Info Checkbox -->
          <div class="form-check mb-3">
            <input
              type="checkbox"
              class="form-check-input"
              id="id-save-info"
              name="save-info"
            />
            <label class="form-check-label" for="id-save-info">
              Save Information
            </label>
          </div>

          <!-- Payment Information Section -->
          <fieldset class="mb-3">
            <legend class="fieldset-label small text-black px-2 w-auto">
              Payment
            </legend>
            <div class="mb-3">
              <div id="card-element" class="form-control"></div>
            </div>
            <div id="card-errors" role="alert" class="text-danger mt-2"></div>
          </fieldset>

          <!-- Complete Order Button -->
          <button type="submit" class="btn-package btn-lg w-100 mb-2">
            <span class="text-uppercase">Complete Order</span>
            <span class="icon"><i class="fas fa-lock"></i></span>
          </button>

          <!-- Card Charge Notice -->
          <p class="small text-danger text-end mb-3">
            <span class="icon"><i class="fas fa-exclamation-circle"></i></span>
            <span
              >Your card will be charged
              <strong>£{{ grand_total|floatformat:2 }}</strong></span
            >
          </p>

          <!-- Back Button -->
          <button
            type="button"
            onclick="window.location.href='{% url 'bag:view_bag' %}'"
            class="btn-package btn-lg no-hover mb-5"
          >
            <i class="fas fa-chevron-left"></i>
            <span class="text-uppercase">Back</span>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block postloadjs %} {{ block.super }} {{
stripe_public_key|json_script:"id_stripe_public_key" }} {{
client_secret|json_script:"id_client_secret" }}
<script src="{% static 'checkout/js/stripe_elements.js' %}"></script>
{% endblock %}
